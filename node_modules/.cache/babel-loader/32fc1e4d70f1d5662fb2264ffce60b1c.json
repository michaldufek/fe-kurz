{"remainingRequest":"/home/dufek/Documents/gitlab/frs-apps/node_modules/babel-loader/lib/index.js!/home/dufek/Documents/gitlab/frs-apps/src/custom/assets/js/helper.js","dependencies":[{"path":"/home/dufek/Documents/gitlab/frs-apps/src/custom/assets/js/helper.js","mtime":1595835860230},{"path":"/home/dufek/Documents/gitlab/frs-apps/.babelrc","mtime":1576496397055},{"path":"/home/dufek/Documents/gitlab/frs-apps/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dufek/Documents/gitlab/frs-apps/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LnJlZ2V4cC5jb25zdHJ1Y3RvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5yZWdleHAucmVwbGFjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5udW1iZXIuaXMtaW50ZWdlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNy5hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5zdHJpbmcuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZnJvbSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM3Lm9iamVjdC52YWx1ZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2Lm51bWJlci5jb25zdHJ1Y3RvciI7CmltcG9ydCBfc2xpY2VkVG9BcnJheSBmcm9tICIvaG9tZS9kdWZlay9Eb2N1bWVudHMvZ2l0bGFiL2Zycy1hcHBzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMyL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LmFycmF5LnNvcnQiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIi9ob21lL2R1ZmVrL0RvY3VtZW50cy9naXRsYWIvZnJzLWFwcHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczIvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgaTE4biBmcm9tICJAL2kxOG4iOwppbXBvcnQgY29uc3RhbnRzIGZyb20gIi4vY29uc3RhbnRzIjsKZXhwb3J0IGRlZmF1bHQgewogIC8vIHN0YXRpc3RpY3MKICBjYWdyOiBmdW5jdGlvbiBjYWdyKGVxdWl0eSwgbnJPZlF1YXJ0ZXJzKSB7CiAgICAvLyBjYWdyID0gKGRmWydlcXVpdHknXS5pbG9jWy0xXSAvIGRmWydlcXVpdHknXS5pbG9jWzBdKSAqKiAoMSAvICh0aW1lX3NwYW4uZGF5cy8zNjUpKSAtIDEKICAgIHJldHVybiBNYXRoLnBvdyhlcXVpdHlbZXF1aXR5Lmxlbmd0aCAtIDFdIC8gZXF1aXR5WzBdLCAxIC8gKG5yT2ZRdWFydGVycyAvIDQpKSAtIDE7CiAgfSwKICB5dGQ6IGZ1bmN0aW9uIHl0ZChkYXRhLCBuck9mUXVhcnRlcnMpIHsKICAgIC8vIHl0ZCA9ICh0aGlzX3llYXJbJ2VxdWl0eSddLmlsb2NbLTFdIC8gdGhpc195ZWFyWydlcXVpdHknXS5pbG9jWzBdKSAqIDEwMCAtIDEwMAogICAgdmFyIGxhc3RfZXF1aXR5ID0gdGhpcy5sYXN0X3F1YXJ0ZXJzX2VxdWl0eShkYXRhLCBuck9mUXVhcnRlcnMpOwogICAgcmV0dXJuIGxhc3RfZXF1aXR5Lmxlbmd0aCA/IGxhc3RfZXF1aXR5W2xhc3RfZXF1aXR5Lmxlbmd0aCAtIDFdIC8gbGFzdF9lcXVpdHlbMF0gKiAxMDAgLSAxMDAgOiAwOwogIH0sCiAgbWF4REQ6IGZ1bmN0aW9uIG1heEREKGRhdGEsIG5yT2ZRdWFydGVycykgewogICAgLy8gbWF4ZGQgPSAoKGRmWydlcXVpdHknXSAtIGRmWydlcXVpdHknXS5jdW1tYXgoKSkgLyBkZlsnZXF1aXR5J10pLm1pbigpICogMTAwCiAgICB2YXIgbGFzdF9lcXVpdHkgPSB0aGlzLmxhc3RfcXVhcnRlcnNfZXF1aXR5KGRhdGEsIG5yT2ZRdWFydGVycyk7CiAgICByZXR1cm4gbGFzdF9lcXVpdHkubGVuZ3RoID8gTWF0aC5taW4uYXBwbHkoTWF0aCwgX3RvQ29uc3VtYWJsZUFycmF5KGxhc3RfZXF1aXR5Lm1hcChmdW5jdGlvbiAodmFsLCBpbmQpIHsKICAgICAgcmV0dXJuICh2YWwgLSBNYXRoLm1heC5hcHBseShNYXRoLCBfdG9Db25zdW1hYmxlQXJyYXkobGFzdF9lcXVpdHkuc2xpY2UoMCwgaW5kICsgMSkpKSkgLyB2YWw7CiAgICB9KSkpICogMTAwIDogMDsKICB9LAogIGxhc3RfcXVhcnRlcnNfZXF1aXR5OiBmdW5jdGlvbiBsYXN0X3F1YXJ0ZXJzX2VxdWl0eShkYXRhLCBucikgewogICAgLy8gdGhpc195ZWFyID0gZGZbZGZbJ3RpbWUnXSA+IGR0LmRhdGV0aW1lKG5vdy55ZWFyLCAxLCAxKV0KICAgIHZhciBub3cgPSBuZXcgRGF0ZShEYXRlLm5vdygpKTsKICAgIHZhciBtb250aEJlZm9yZSA9IG5vdy5nZXRNb250aCgpIC0gbnIgKiAzOwogICAgdmFyIHllYXJCZWZvcmUgPSBub3cuZ2V0RnVsbFllYXIoKSAtIChtb250aEJlZm9yZSA8IDAgPyAxIDogMCk7CiAgICB2YXIgdGltZUZpbHRlcmVkID0gZGF0YS50aW1lLmZpbHRlcihmdW5jdGlvbiAoZHQpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGR0KSA+PSBuZXcgRGF0ZSh5ZWFyQmVmb3JlLCBtb250aEJlZm9yZSA8IDAgPyAxMiArIG1vbnRoQmVmb3JlIDogbW9udGhCZWZvcmUsIG5vdy5nZXREYXRlKCkpOwogICAgfSk7CiAgICByZXR1cm4gZGF0YS5lcXVpdHkuc2xpY2UoZGF0YS5lcXVpdHkubGVuZ3RoIC0gdGltZUZpbHRlcmVkLmxlbmd0aCwgZGF0YS5lcXVpdHkubGVuZ3RoKTsKICB9LAogIC8vIGFncmVnYXRvcnMKICBzb3J0QWdncmVnYXRvcjogZnVuY3Rpb24gc29ydEFnZ3JlZ2F0b3Iob2xkUm93cywgbmV3Um93cywgc29ydENsKSB7CiAgICByZXR1cm4gb2xkUm93cy5jb25jYXQobmV3Um93cykuc29ydChmdW5jdGlvbiAocm93MSwgcm93MikgewogICAgICAvLyBzb3J0IGluIGRlc2NlbmRpbmcgb3JkZXIgYnkgZGF0ZVRpbWUKICAgICAgaWYgKHJvdzFbc29ydENsXSA+IHJvdzJbc29ydENsXSkgcmV0dXJuIC0xOwogICAgICBpZiAocm93MVtzb3J0Q2xdIDwgcm93Mltzb3J0Q2xdKSByZXR1cm4gMTsKICAgICAgLyogZWxzZSAqLwoKICAgICAgcmV0dXJuIDA7CiAgICB9KTsKICB9LAogIHdlaWdodGVkQXZlcmFnZUFnZ3JlZ2F0b3I6IGZ1bmN0aW9uIHdlaWdodGVkQXZlcmFnZUFnZ3JlZ2F0b3Iob2xkUm93cywgbmV3Um93cywgd2VpZ2h0KSB7CiAgICB2YXIgbGFzdFJvd05vQXZlcmFnZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogdHJ1ZTsKICAgIC8vIGF2ZXJhZ2UgdmFsdWVzIGF0IHNhbWUgcGxhY2UKICAgIHZhciByb3dzID0gW107CiAgICB2YXIgZmlyc3RUaW1lID0gIW9sZFJvd3MubGVuZ3RoIHx8ICFuZXdSb3dzLmxlbmd0aDsKICAgIHZhciBhbGxSb3dzID0gZmlyc3RUaW1lID8gb2xkUm93cy5jb25jYXQobmV3Um93cykgOiBvbGRSb3dzOwogICAgdmFyIHJvd05yID0gMDsKICAgIGFsbFJvd3MuZm9yRWFjaChmdW5jdGlvbiAob2xkUm93KSB7CiAgICAgIHZhciBhZ2dSb3cgPSB7fTsKCiAgICAgIGZvciAodmFyIF9pID0gMCwgX09iamVjdCRlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMob2xkUm93KTsgX2kgPCBfT2JqZWN0JGVudHJpZXMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgdmFyIF9PYmplY3QkZW50cmllcyRfaSA9IF9zbGljZWRUb0FycmF5KF9PYmplY3QkZW50cmllc1tfaV0sIDIpLAogICAgICAgICAgICBrZXkgPSBfT2JqZWN0JGVudHJpZXMkX2lbMF0sCiAgICAgICAgICAgIG9sZFZhbCA9IF9PYmplY3QkZW50cmllcyRfaVsxXTsKCiAgICAgICAgaWYgKHR5cGVvZiBvbGRWYWwgPT09ICJib29sZWFuIikgewogICAgICAgICAgdmFyIG5ld1ZhbCA9IG9sZFZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCFvbGRWYWwpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9sZFZhbCBpbnN0YW5jZW9mIE51bWJlciB8fCB0eXBlb2Ygb2xkVmFsID09PSAnbnVtYmVyJykgewogICAgICAgICAgICBuZXdWYWwgPSBvbGRWYWw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBzcGxpdCBiZWNhdXNlIGluIHBvcnRmb2xpbyBjYXJkIGl0IGlzIGluICc8c3RhdGlzdGljTmFtZT46IDxudW1iZXI+JyBmb3JtYXQKICAgICAgICAgICAgdmFyIHNlcCA9ICc6ICc7CiAgICAgICAgICAgIHZhciBvbGRWYWxTcGxpdHRlZCA9IG9sZFZhbC5zcGxpdChzZXApOwogICAgICAgICAgICBuZXdWYWwgPSBvbGRWYWxTcGxpdHRlZFtvbGRWYWxTcGxpdHRlZC5sZW5ndGggLSAxXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWlzTmFOKE51bWJlcihuZXdWYWwpKSkgewogICAgICAgICAgICAvLyBmaW5hbCB3ZWlnaHRlZCBhdmVyYWdlIG9mIG9sZCBhbmQgbmV3IHZhbHVlCiAgICAgICAgICAgIHZhciBub0F2ZXJhZ2UgPSAhKGxhc3RSb3dOb0F2ZXJhZ2UgJiYgcm93TnIgPT09IGFsbFJvd3MubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIHZhciBuZXdXZWlnaHQgPSBub0F2ZXJhZ2UgPyB3ZWlnaHQgOiAxOwogICAgICAgICAgICBuZXdWYWwgPSAoZmlyc3RUaW1lID8gbmV3V2VpZ2h0IDogMSkgKiBOdW1iZXIobmV3VmFsKSArIChmaXJzdFRpbWUgPyAwIDogbmV3V2VpZ2h0ICogKG9sZFZhbFNwbGl0dGVkICYmIG9sZFZhbFNwbGl0dGVkLmxlbmd0aCA+IDEgPyBOdW1iZXIobmV3Um93c1tyb3dOcl1ba2V5XS5zcGxpdChzZXApWzFdKSA6IG5ld1Jvd3Nbcm93TnJdW2tleV0pKTsKCiAgICAgICAgICAgIGlmIChub0F2ZXJhZ2UgJiYgIWZpcnN0VGltZSkgewogICAgICAgICAgICAgIC8vIGl0J3MgcHJvYmFibHkgRXF1aXR5IG91dHN0YW5kaW5nIHN0YXRpc3RpYyAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgbmV3VmFsIC89IDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob2xkVmFsU3BsaXR0ZWQgJiYgb2xkVmFsU3BsaXR0ZWQubGVuZ3RoID4gMSkgewogICAgICAgICAgICBuZXdWYWwgPSBbb2xkVmFsU3BsaXR0ZWRbMF0sIG5ld1ZhbF0uam9pbihzZXApOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYWdnUm93W2tleV0gPSBuZXdWYWw7CiAgICAgIH0KCiAgICAgIHJvd3MucHVzaChhZ2dSb3cpOwogICAgICByb3dOcisrOwogICAgfSk7CiAgICByZXR1cm4gcm93czsKICB9LAogIGNyZWF0ZVRyYWRlc1JvdzogZnVuY3Rpb24gY3JlYXRlVHJhZGVzUm93KHJvd3MsIGRhdHVtLCBiYXNlKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHZhciByb3dOciA9IDA7CiAgICBPYmplY3Qua2V5cyhkYXR1bS5vdXRwdXQudHJhZGVzLnBubCkuZm9yRWFjaChmdW5jdGlvbiAoXykgewogICAgICByZXR1cm4gcm93cy5wdXNoKFtyb3dOciArIDEsIC8vICMgICAgICAgICAgICAgICAgICAgIAogICAgICBiYXNlLnN5bWJvbCwgLy8gQXNzZXQgICAgICAgICAgICAgICAgICAgIAogICAgICBiYXNlLnBhdHRlcm4sIC8vIFBhdHRlcm4KICAgICAgZGF0dW0uZGlyZWN0aW9uLCAvLyBEaXJlY3Rpb24KICAgICAgJ0VudHJ5IHByaWNlJywgLy8gRW50cnkgcHJpY2UKICAgICAgJ0V4aXQgcHJpY2UnLCAvLyBFeGl0IHByaWNlCiAgICAgIF90aGlzLmZvcm1hdERhdGVUaW1lKGRhdHVtLm91dHB1dC50cmFkZXMuc3RhcnRbcm93TnJdKSwgLy8gRW50cnkgdGltZQogICAgICBfdGhpcy5mb3JtYXREYXRlVGltZShkYXR1bS5vdXRwdXQudHJhZGVzLmZpbmlzaFtyb3dOcl0pLCAvLyBFeGl0IHRpbWUKICAgICAgJ0Ftb3VudCcsIC8vIEFtb3VudAogICAgICBkYXR1bS5vdXRwdXQudHJhZGVzLnBubFtyb3dOcisrXSAvLyBQbkwKICAgICAgXSk7CiAgICB9KTsKICB9LAogIGNyZWF0ZVBlcmZNZXRyaWNzUm93OiBmdW5jdGlvbiBjcmVhdGVQZXJmTWV0cmljc1Jvdyhyb3dzLCBkYXR1bSwgYmFzZSkgewogICAgcm93cy5wdXNoKFtiYXNlLnN5bWJvbCwgLy8gQXNzZXQKICAgIGJhc2UucGF0dGVybiwgLy8gUGF0dGVybgogICAgT2JqZWN0LmtleXMoZGF0dW0ub3V0cHV0LnRyYWRlcy5wbmwpLmxlbmd0aCwgLy8gIyBvZiB0cmFkZXMKICAgICIiLmNvbmNhdChkYXR1bS5pbml0aWFsX2NhcGl0YWwsICIgIikuY29uY2F0KGNvbnN0YW50cy5kZWZhdWx0VW5pdCksIC8vIEluaXRpYWwgY2FwaXRhbAogICAgIiIuY29uY2F0KGRhdHVtLmluaXRpYWxfY2FwaXRhbCArIGRhdHVtLm91dHB1dC5zdGF0c1siQ3VtbXVsYXRpdmUgcG5sIGZpbmFsIl0sICIgIikuY29uY2F0KGNvbnN0YW50cy5kZWZhdWx0VW5pdCksIC8vIEVuZCBjYXBpdGFsCiAgICAiIi5jb25jYXQoZGF0dW0ub3V0cHV0LnN0YXRzWyJDdW1tdWxhdGl2ZSBwbmwgZmluYWwiXSwgIiAiKS5jb25jYXQoY29uc3RhbnRzLmRlZmF1bHRVbml0KSwgLy8gQ3VtbXVsYXRpdmUgUG5MIGZpbmFsCiAgICAnQ0FHUicsIC8vIENBR1IKICAgIGRhdHVtLm91dHB1dC5zdGF0c1siU2hhcnBlIHJhdGlvIl0sIC8vIFNoYXJwZSByYXRpbwogICAgIiIuY29uY2F0KGRhdHVtLnByb2ZpdF90YWtlX3ZhbHVlLCAiICIpLmNvbmNhdChkYXR1bS5wcm9maXRfdGFrZV91bml0KSwgLy8gUFQKICAgICIiLmNvbmNhdChkYXR1bS5zdG9wX2xvc3NfdmFsdWUsICIgIikuY29uY2F0KGRhdHVtLnN0b3BfbG9zc191bml0KSwgLy8gU0wKICAgIGRhdHVtLm91dHB1dC5zdGF0c1siQXZnLiB0cmFkZSBuZXQgcHJvZml0IHBlciB0cmFkZSJdLCAvLyBBdmVyYWdlIHRyYWRlCiAgICBkYXR1bS5vdXRwdXQuc3RhdHNbIk1heCBkcmF3ZG93biBzdHJhdGVneSJdIC8vIE1heCBkcmF3ZG93biBzdHJhdGVneQogICAgXSk7CiAgfSwKICAvLyBkYXRlLXRpbWUgdHlwZXMgZm9ybWF0dGluZyAgICAKICBwYWQ6IGZ1bmN0aW9uIHBhZChucikgewogICAgcmV0dXJuIFN0cmluZyhucikubGVuZ3RoIDwgMiA/ICIwIiArIG5yIDogbnI7CiAgfSwKICBmb3JtYXREYXRlOiBmdW5jdGlvbiBmb3JtYXREYXRlKGR0KSB7CiAgICB2YXIgZGVsaW1pdGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAiLSI7CgogICAgLy8gcmV0dXJucyBSUlJSPGRlbGltaXRlcj5NTTxkZWxpbWl0ZXI+REQgZm9ybWF0CiAgICBpZiAoZHQpIHsKICAgICAgdmFyIG5ld0R0ID0gbmV3IERhdGUoZHQpOwogICAgICByZXR1cm4gbmV3RHQuZ2V0RnVsbFllYXIoKSArIGRlbGltaXRlciArIHRoaXMucGFkKE51bWJlcihuZXdEdC5nZXRNb250aCgpICsgMSkpICsgZGVsaW1pdGVyICsgdGhpcy5wYWQobmV3RHQuZ2V0RGF0ZSgpKTsKICAgIH0KICB9LAogIGRlZm9ybWF0RGF0ZTogZnVuY3Rpb24gZGVmb3JtYXREYXRlKGRhdGUpIHsKICAgIC8vIGZvciBSUlJSTU1ERCBmb3JtYXR0ZWQgaW5wdXRzCiAgICAvLyByZXR1cm5zIG5ldyBEYXRlKCkgZm9ybWF0CiAgICByZXR1cm4gZGF0ZSAhPT0gbnVsbCA/IG5ldyBEYXRlKGRhdGUuc3Vic3RyaW5nKDAsIDQpLCBOdW1iZXIoZGF0ZS5zdWJzdHJpbmcoNCwgNikpIC0gMSwgZGF0ZS5zdWJzdHJpbmcoNiwgOCkpIDogbnVsbDsKICB9LAogIGZvcm1hdERhdGVUaW1lOiBmdW5jdGlvbiBmb3JtYXREYXRlVGltZShkdCkgewogICAgLy8gcmV0dXJucyBSUlJSLU1NLUREIEhIOk1NOlNTIGZvcm1hdHRlZCBkYXRlIGZyb20gc3RyaW5nIG9mIHR5cGUgWVlZWS1NTS1ERFRISDpNTTpTUwogICAgdmFyIG5ld0R0ID0gbmV3IERhdGUoZHQpOwogICAgcmV0dXJuIHRoaXMuZm9ybWF0RGF0ZShuZXdEdCkgKyAiICIgKyB0aGlzLnBhZChuZXdEdC5nZXRIb3VycygpKSArICI6IiArIHRoaXMucGFkKG5ld0R0LmdldE1pbnV0ZXMoKSkgKyAiOiIgKyB0aGlzLnBhZChuZXdEdC5nZXRTZWNvbmRzKCkpOwogIH0sCiAgZm9ybWF0RGF0ZU9ubHk6IGZ1bmN0aW9uIGZvcm1hdERhdGVPbmx5KGRhdGUpIHsKICAgIC8vIGZvciBSUlJSTU1ERCBmb3JtYXR0ZWQgaW5wdXRzCiAgICAvLyByZXR1cm5zIGluIFJSUlItTS1EIGZvcm1hdAogICAgcmV0dXJuIGRhdGUuc3Vic3RyaW5nKDAsIDQpICsgIi0iICsgZGF0ZS5zdWJzdHJpbmcoNCwgNikgKyAiLSIgKyBkYXRlLnN1YnN0cmluZyg2LCA4KTsKICB9LAogIGZvcm1hdERhdGVUaW1lczogZnVuY3Rpb24gZm9ybWF0RGF0ZVRpbWVzKGRhdGV0aW1lcykgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgLy8gZm9ybWF0RGF0ZXRpbWUgb24gYXJyYXkKICAgIHZhciBuZXdEYXRldGltZXMgPSBbXTsKICAgIGRhdGV0aW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChkdCkgewogICAgICBuZXdEYXRldGltZXMucHVzaChfdGhpczIuZm9ybWF0RGF0ZVRpbWUoZHQpKTsKICAgIH0pOwogICAgcmV0dXJuIG5ld0RhdGV0aW1lczsKICB9LAogIGlzTnVtYmVyOiBmdW5jdGlvbiBpc051bWJlcih2YWwpIHsKICAgIHJldHVybiB2YWwgaW5zdGFuY2VvZiBOdW1iZXIgfHwgdHlwZW9mIHZhbCA9PT0gJ251bWJlcic7CiAgfSwKICBub3RpZnlBdWRpbzogZnVuY3Rpb24gbm90aWZ5QXVkaW8oc2VsZiwgZWxlbWVudCwgdHlwZSwgbXNnKSB7CiAgICBlbGVtZW50LnBsYXkoKTsKICAgIHNlbGYuJG5vdGlmeSh7CiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIG1lc3NhZ2U6IG1zZwogICAgfSk7CiAgfSwKICAvLyBjb252ZXJ0b3JzCiAgY29udmVydFRpbWVmcmFtZTogZnVuY3Rpb24gY29udmVydFRpbWVmcmFtZSh0aW1lZnJhbWUpIHsKICAgIHZhciBpbmRleCA9IGkxOG4udCgncmVzZWFyY2gucGF0dGVybkxhYi50aW1lZnJhbWVzJykuaW5kZXhPZih0aW1lZnJhbWUpOwogICAgcmV0dXJuIGluZGV4ID4gLTEgPyBpbmRleCArIDEgOiAtMTsKICB9LAogIGNvbnZlcnREaXJlY3Rpb246IGZ1bmN0aW9uIGNvbnZlcnREaXJlY3Rpb24obnIpIHsKICAgIHJldHVybiAhbnIgPyBuciA6IG5yID4gMCA/IGNvbnN0YW50cy5zdHJpbmdzLmJ1bGxpc2ggOiBjb25zdGFudHMuc3RyaW5ncy5iZWFyaXNoOwogIH0sCiAgLy8gcXVlcnkgJiB1cmxzIG1ldGhvZHMKICBtYXBTdHJhdGVneUZyb21Sb3c6IGZ1bmN0aW9uIG1hcFN0cmF0ZWd5RnJvbVJvdyhyb3cpIHsKICAgIHZhciBtYXAgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7CiAgICAvLyBtYXAgUGF0dGVybnMgdGFibGUgcm93IHRvIEFQSSBzdHJ1Y3R1cmUKICAgIHZhciBkYXRhID0ge307CiAgICB2YXIgY2xOciA9IDE7IC8vIDB0aCBpcyBOYW1lIC0gbm8gbmVlZCB0byBtYXAKCiAgICB2YXIgY29sdW1ucyA9IGkxOG4udChjb25zdGFudHMudHJhbnNsYXRpb25LZXlzLnBhdHRlcm5zICsgJy5jb2x1bW5zJyk7CiAgICB2YXIgdmFsID0gbWFwICYmIHJvdy5nZXQoY29sdW1uc1tjbE5yXS50b0xvd2VyQ2FzZSgpKSB8fCAhbWFwICYmIHJvd1tjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCldOwoKICAgIGlmICh2YWwpIHsKICAgICAgZGF0YVsnc3RhcnRfZGF0ZSddID0gdmFsOyAvLyBGcm9tCiAgICB9CgogICAgY2xOcisrOwogICAgdmFsID0gbWFwICYmIHJvdy5nZXQoY29sdW1uc1tjbE5yXS50b0xvd2VyQ2FzZSgpKSB8fCAhbWFwICYmIHJvd1tjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCldOwoKICAgIGlmICh2YWwpIHsKICAgICAgZGF0YVsnZmluaXNoX2RhdGUnXSA9IHZhbDsgLy8gVG8KICAgIH0KCiAgICBjbE5yKys7CiAgICB2YWwgPSBtYXAgJiYgcm93LmdldChjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCkpIHx8ICFtYXAgJiYgcm93W2NvbHVtbnNbY2xOcl0udG9Mb3dlckNhc2UoKV07CgogICAgaWYgKHZhbCkgewogICAgICBkYXRhWyd0aW1lX2ZyYW1lJ10gPSBpMThuLnQoJ3Jlc2VhcmNoLnBhdHRlcm5MYWIudGltZWZyYW1lcycpLmluZGV4T2YodmFsKSArIDE7IC8vIFRpbWUgZnJhbWUgICAgLy8gaXQncyBhIGJpZyBteXN0ZXJ5IHdoeSBCRSBpbmRleGVzIGZyb20gMQogICAgfQoKICAgIHZhbCA9IG1hcCAmJiByb3cuZ2V0KCdhc3NldElkJykgfHwgIW1hcCAmJiByb3dbJ2Fzc2V0SWQnXTsKICAgIGRhdGFbJ2Fzc2V0J10gPSB2YWw7IC8vIEFzc2V0CgogICAgdmFsID0gbWFwICYmIHJvdy5nZXQoJ3BhdHRlcm5JZCcpIHx8ICFtYXAgJiYgcm93WydwYXR0ZXJuSWQnXTsKICAgIGRhdGFbJ3BhdHRlcm4nXSA9IHZhbDsgLy8gUGF0dGVybgoKICAgIGNsTnIgKz0gMzsKICAgIHZhbCA9IG1hcCAmJiByb3cuZ2V0KGNvbHVtbnNbY2xOcl0udG9Mb3dlckNhc2UoKSkgfHwgIW1hcCAmJiByb3dbY29sdW1uc1tjbE5yXS50b0xvd2VyQ2FzZSgpXTsKCiAgICBpZiAodmFsKSB7CiAgICAgIGRhdGFbJ2luaXRpYWxfY2FwaXRhbCddID0gdmFsLnNwbGl0KCcgJylbMF07CiAgICB9CgogICAgY2xOciArPSAyOwogICAgdmFsID0gbWFwICYmIHJvdy5nZXQoY29sdW1uc1tjbE5yXS50b0xvd2VyQ2FzZSgpKSB8fCAhbWFwICYmIHJvd1tjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCldOwoKICAgIGlmICh2YWwpIHsKICAgICAgdmFyIHByb2ZpdF90YWtlID0gdmFsLnNwbGl0KCcgJyk7CiAgICAgIGRhdGFbJ3Byb2ZpdF90YWtlX3ZhbHVlJ10gPSBwcm9maXRfdGFrZVswXTsKICAgICAgZGF0YVsncHJvZml0X3Rha2VfdW5pdCddID0gcHJvZml0X3Rha2VbMV07CiAgICB9CgogICAgY2xOcisrOwogICAgdmFsID0gbWFwICYmIHJvdy5nZXQoY29sdW1uc1tjbE5yXS50b0xvd2VyQ2FzZSgpKSB8fCAhbWFwICYmIHJvd1tjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCldOwoKICAgIGlmICh2YWwpIHsKICAgICAgdmFyIHN0b3BfbG9zcyA9IHZhbC5zcGxpdCgnICcpOwogICAgICBkYXRhWydzdG9wX2xvc3NfdmFsdWUnXSA9IHN0b3BfbG9zc1swXTsKICAgICAgZGF0YVsnc3RvcF9sb3NzX3VuaXQnXSA9IHN0b3BfbG9zc1sxXTsKICAgIH0KCiAgICBjbE5yKys7CiAgICB2YWwgPSBtYXAgJiYgcm93LmdldChjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCkpIHx8ICFtYXAgJiYgcm93W2NvbHVtbnNbY2xOcl0udG9Mb3dlckNhc2UoKV07CgogICAgaWYgKHZhbCkgewogICAgICBkYXRhWydtYV9maWx0ZXJfcGVyaW9kJ10gPSB2YWwuc3BsaXQoJyAnKVswXTsKICAgIH0KCiAgICBjbE5yKys7CiAgICB2YWwgPSBtYXAgJiYgcm93LmdldChjb2x1bW5zW2NsTnJdLnRvTG93ZXJDYXNlKCkpIHx8ICFtYXAgJiYgcm93W2NvbHVtbnNbY2xOcl0udG9Mb3dlckNhc2UoKV07CiAgICB2YXIgZGlyZWN0aW9ucyA9IGkxOG4udCgncmVzZWFyY2gucGF0dGVybkxhYi5iYWNrdGVzdFBhdHRlcm5zLmVudHJ5UnVsZXMuZGlyZWN0aW9ucycpOwogICAgZGF0YVsnZGlyZWN0aW9uJ10gPSBPYmplY3Qua2V5cyhkaXJlY3Rpb25zKVtPYmplY3QudmFsdWVzKGRpcmVjdGlvbnMpLmluZGV4T2YodmFsKV07CiAgICB2YWwgPSBtYXAgJiYgcm93LmdldCgnZml4ZWRfYW1vdW50JykgfHwgIW1hcCAmJiByb3dbJ2ZpeGVkX2Ftb3VudCddOwoKICAgIGlmICh2YWwpIHsKICAgICAgZGF0YVsnZml4ZWRfYW1vdW50J10gPSB2YWw7IC8vIFJpc2sKICAgIH0KCiAgICByZXR1cm4gZGF0YTsKICB9LAogIGdldFBhdHRlcm5MYWJRdWVyeURhdGE6IGZ1bmN0aW9uIGdldFBhdHRlcm5MYWJRdWVyeURhdGEoYXNzZXRzLCBwYXR0ZXJucywgdGltZWZyYW1lKSB7CiAgICB2YXIgZGF0YSA9IHt9OwogICAgZGF0YVsnc3ltYm9scyddID0gYXNzZXRzLm1hcChmdW5jdGlvbiAoc2EpIHsKICAgICAgcmV0dXJuIHNhLnN5bWJvbDsKICAgIH0pOwogICAgZGF0YVsncGF0dGVybnMnXSA9IHBhdHRlcm5zLm1hcChmdW5jdGlvbiAoc3ApIHsKICAgICAgcmV0dXJuIHNwLmlkOwogICAgfSk7CiAgICBkYXRhWyd0aW1lZnJhbWUnXSA9IHRoaXMuY29udmVydFRpbWVmcmFtZSh0aW1lZnJhbWUpOwogICAgcmV0dXJuIGRhdGE7CiAgfSwKICBlbmNvZGVRdWVyeURhdGE6IGZ1bmN0aW9uIGVuY29kZVF1ZXJ5RGF0YShkYXRhKSB7CiAgICB2YXIgcmV0ID0gW107CgogICAgZm9yICh2YXIgZCBpbiBkYXRhKSB7CiAgICAgIGlmIChkYXRhW2RdICE9PSBudWxsICYmIGRhdGFbZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldC5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChkKSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChkYXRhW2RdKSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gIj8iICsgcmV0LmpvaW4oJyYnKTsKICB9LAogIGdldFBhdHRlcm5MYWJDaGFydFVybDogZnVuY3Rpb24gZ2V0UGF0dGVybkxhYkNoYXJ0VXJsKGFzc2V0LCB0aW1lZnJhbWUpIHsKICAgIHZhciByYW5nZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogbnVsbDsKICAgIHJldHVybiBjb25zdGFudHMudXJscy5wYXR0ZXJuTGFiLmNoYXJ0ICsgdGhpcy5lbmNvZGVSb3V0ZVBhcmFtcyhbYXNzZXQuaWQsIHRoaXMuY29udmVydFRpbWVmcmFtZSh0aW1lZnJhbWUpXSkgKyB0aGlzLmVuY29kZVF1ZXJ5RGF0YShyYW5nZSk7CiAgfSwKICBnZXRQYXR0ZXJuTGFiSGlzdG9yeVVybDogZnVuY3Rpb24gZ2V0UGF0dGVybkxhYkhpc3RvcnlVcmwoYXNzZXRzLCBwYXR0ZXJucywgdGltZWZyYW1lKSB7CiAgICByZXR1cm4gYXNzZXRzLmxlbmd0aCAmJiBwYXR0ZXJucy5sZW5ndGggPyBbY29uc3RhbnRzLnVybHMucGF0dGVybkxhYi5wYXR0ZXJuc0hpc3RvcnkgKyB0aGlzLmVuY29kZVF1ZXJ5RGF0YSh0aGlzLmdldFBhdHRlcm5MYWJRdWVyeURhdGEoYXNzZXRzLCBwYXR0ZXJucywgdGltZWZyYW1lKSldIDogW107CiAgfSwKICBlbmNvZGVSb3V0ZVBhcmFtczogZnVuY3Rpb24gZW5jb2RlUm91dGVQYXJhbXMoZGF0YSkgewogICAgcmV0dXJuIGRhdGEuam9pbignLycpOwogIH0sCiAgLy8gc3RvcmUgbWV0aG9kcwogIGdldEFzc2V0c1BhdHRlcm5zUGlja2VyRGF0YTogZnVuY3Rpb24gZ2V0QXNzZXRzUGF0dGVybnNQaWNrZXJEYXRhKHN0b3JlKSB7CiAgICB2YXIgZGF0YSA9IHN0b3JlLmdldEl0ZW0oY29uc3RhbnRzLnN0b3JlS2V5cy5hc3NldHNQYXR0ZXJuc1BpY2tlcik7CgogICAgaWYgKGRhdGEpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0aW1lZnJhbWU6IGkxOG4udCgncmVzZWFyY2gucGF0dGVybkxhYi50aW1lZnJhbWVzJylbZGF0YS50aW1lZnJhbWUgPyBkYXRhLnRpbWVmcmFtZSA6IDBdLAogICAgICAgIHJhbmdlOiB7CiAgICAgICAgICBmcm9tOiBkYXRhLnJhbmdlICYmIGRhdGEucmFuZ2UuZnJvbSA/IGRhdGEucmFuZ2UuZnJvbSA6IG51bGwsCiAgICAgICAgICB0bzogZGF0YS5yYW5nZSAmJiBkYXRhLnJhbmdlLnRvID8gZGF0YS5yYW5nZS50byA6IG51bGwKICAgICAgICB9LAogICAgICAgIC8vIGFzc2V0cwogICAgICAgIHNlbGVjdGVkQXNzZXRzOiBkYXRhLnNlbGVjdGVkQXNzZXRzID8gZGF0YS5zZWxlY3RlZEFzc2V0cyA6IFtdLAogICAgICAgIGNoZWNrZWRBc3NldHM6IGRhdGEuY2hlY2tlZEFzc2V0cyA/IGRhdGEuY2hlY2tlZEFzc2V0cyA6IGRhdGEuc2VsZWN0ZWRBc3NldHMgPyBkYXRhLnNlbGVjdGVkQXNzZXRzIDogW10sCiAgICAgICAgY2hlY2tlZEFzc2V0OiBkYXRhLmNoZWNrZWRBc3NldCA/IGRhdGEuY2hlY2tlZEFzc2V0IDogZGF0YS5jaGVja2VkQXNzZXRzICYmIGRhdGEuY2hlY2tlZEFzc2V0cy5sZW5ndGggPyBkYXRhLmNoZWNrZWRBc3NldHNbMF0gOiBudWxsLAogICAgICAgIC8vIHBhdHRlcm5zCiAgICAgICAgc2VsZWN0ZWRQYXR0ZXJuczogZGF0YS5zZWxlY3RlZFBhdHRlcm5zID8gZGF0YS5zZWxlY3RlZFBhdHRlcm5zIDogW10sCiAgICAgICAgY2hlY2tlZFBhdHRlcm5zOiBkYXRhLmNoZWNrZWRQYXR0ZXJucyA/IGRhdGEuY2hlY2tlZFBhdHRlcm5zIDogW10sCiAgICAgICAgY2hlY2tlZEFsbFBhdHRlcm5zOiBkYXRhLmNoZWNrZWRBbGxQYXR0ZXJucwogICAgICB9OwogICAgfQogIH0sCiAgdXBkYXRlU3RvcmU6IGZ1bmN0aW9uIHVwZGF0ZVN0b3JlKHN0b3JlLCBrZXksIHZhbHVlKSB7CiAgICB2YXIgc3RvcmVLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IGNvbnN0YW50cy5zdG9yZUtleXMuYXNzZXRzUGF0dGVybnNQaWNrZXI7CiAgICB2YXIgc3RvcmVEYXRhID0gc3RvcmUuZ2V0SXRlbShzdG9yZUtleSk7CgogICAgaWYgKCFzdG9yZURhdGEpIHsKICAgICAgc3RvcmVEYXRhID0ge307CiAgICB9CgogICAgc3RvcmVEYXRhW2tleV0gPSB2YWx1ZTsKICAgIHN0b3JlLnNldEl0ZW0oc3RvcmVLZXksIHN0b3JlRGF0YSk7CiAgfSwKICB1cGRhdGVTdG9yZUJhY2t0ZXN0czogZnVuY3Rpb24gdXBkYXRlU3RvcmVCYWNrdGVzdHMoc3RvcmUsIGtleSwgdmFsdWUpIHsKICAgIHZhciBzdG9yZUtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogY29uc3RhbnRzLnN0b3JlS2V5cy5hc3NldHNQYXR0ZXJuc1BpY2tlcjsKICAgIHRoaXMudXBkYXRlU3RvcmUoc3RvcmUsIGtleSwgdmFsdWUubWFwKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgdmFyIG5ld1JvdyA9IG5ldyBNYXAocm93KTsKICAgICAgdmFyIHRpbWVmcmFtZUtleSA9IGkxOG4udChjb25zdGFudHMudHJhbnNsYXRpb25LZXlzLnBhdHRlcm5zICsgJy5jb2x1bW5zJylbM10udG9Mb3dlckNhc2UoKTsKICAgICAgdmFyIGRpcmVjdGlvbktleSA9IGkxOG4udChjb25zdGFudHMudHJhbnNsYXRpb25LZXlzLnBhdHRlcm5zICsgJy5jb2x1bW5zJylbMTFdLnRvTG93ZXJDYXNlKCk7CiAgICAgIG5ld1Jvdy5zZXQoZGlyZWN0aW9uS2V5LCBPYmplY3QudmFsdWVzKGkxOG4udCgncmVzZWFyY2gucGF0dGVybkxhYi5iYWNrdGVzdFBhdHRlcm5zLmVudHJ5UnVsZXMuZGlyZWN0aW9ucycpKS5pbmRleE9mKHJvdy5nZXQoZGlyZWN0aW9uS2V5KSkpOwogICAgICBuZXdSb3cuc2V0KHRpbWVmcmFtZUtleSwgaTE4bi50KCdyZXNlYXJjaC5wYXR0ZXJuTGFiLnRpbWVmcmFtZXMnKS5pbmRleE9mKHJvdy5nZXQodGltZWZyYW1lS2V5KSkpOwogICAgICByZXR1cm4gQXJyYXkuZnJvbShuZXdSb3cudmFsdWVzKCkpOwogICAgfSksIHN0b3JlS2V5KTsgLy8gY2Fubm90IHN0b3JlIGxhbmd1YWdlIGRlcGVuZGVudCBrZXlzCiAgfSwKICBnZXRTdG9yZWRCYWNrdGVzdHM6IGZ1bmN0aW9uIGdldFN0b3JlZEJhY2t0ZXN0cyhkYXRhKSB7CiAgICB2YXIgYnRzID0gW107CgogICAgaWYgKGRhdGEuYmFja3Rlc3RzKSB7CiAgICAgIGRhdGEuYmFja3Rlc3RzLmZvckVhY2goZnVuY3Rpb24gKGJ0KSB7CiAgICAgICAgdmFyIHJvdyA9IG5ldyBNYXAoKTsKICAgICAgICB2YXIgY2xOciA9IDA7CiAgICAgICAgcm93LnNldCgnYnRJZCcsIGJ0W2NsTnIrK10pOwogICAgICAgIHJvdy5zZXQoJ2Fzc2V0SWQnLCBidFtjbE5yKytdKTsKICAgICAgICByb3cuc2V0KCdwYXR0ZXJuSWQnLCBidFtjbE5yKytdKTsgLy8gYWRkIGNvbHVtbnMgdmFsdWVzIGZyb20gdHJhbnNsYXRpb25zCgogICAgICAgIHZhciBjbHMgPSBpMThuLnQoY29uc3RhbnRzLnRyYW5zbGF0aW9uS2V5cy5wYXR0ZXJucyArICcuY29sdW1ucycpOwogICAgICAgIGNscy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHsKICAgICAgICAgIGlmIChjb2x1bW4pIHsKICAgICAgICAgICAgcm93LnNldChjb2x1bW4udG9Mb3dlckNhc2UoKSwgYnRbY2xOcisrXSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHRpbWVmcmFtZUtleSA9IGNsc1szXS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHZhciBkaXJlY3Rpb25LZXkgPSBjbHNbMTFdLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcm93LnNldChkaXJlY3Rpb25LZXksIE9iamVjdC52YWx1ZXMoaTE4bi50KCdyZXNlYXJjaC5wYXR0ZXJuTGFiLmJhY2t0ZXN0UGF0dGVybnMuZW50cnlSdWxlcy5kaXJlY3Rpb25zJykpW3Jvdy5nZXQoZGlyZWN0aW9uS2V5KV0pOwogICAgICAgIHJvdy5zZXQodGltZWZyYW1lS2V5LCBpMThuLnQoJ3Jlc2VhcmNoLnBhdHRlcm5MYWIudGltZWZyYW1lcycpW3Jvdy5nZXQodGltZWZyYW1lS2V5KV0pOwogICAgICAgIHJvdy5zZXQoJ2ZpeGVkX2Ftb3VudCcsIGJ0WzE1XSk7IC8vIFJpc2sKCiAgICAgICAgYnRzLnB1c2gocm93KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIGJ0czsKICB9LAogIGdldEJhY2t0ZXN0c05hbWVzOiBmdW5jdGlvbiBnZXRCYWNrdGVzdHNOYW1lcyhzdG9yZSwgc3RvcmVLZXksIHVwZGF0ZUtleSkgewogICAgdmFyIGRhdGEgPSBzdG9yZS5nZXRJdGVtKGNvbnN0YW50cy5zdG9yZUtleXMuYmFja3Rlc3RQYXR0ZXJucyk7CiAgICB2YXIgYmFja3Rlc3RzTmFtZXMgPSBbXTsKICAgIHZhciBzZWxlY3RlZEJhY2t0ZXN0ID0gbnVsbDsKCiAgICBpZiAoZGF0YSkgewogICAgICB2YXIgbG9hZGluZyA9IGRhdGEubG9hZGluZzsKICAgICAgdGhpcy5nZXRTdG9yZWRCYWNrdGVzdHMoZGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoYnQpIHsKICAgICAgICByZXR1cm4gYmFja3Rlc3RzTmFtZXMucHVzaCh7CiAgICAgICAgICBpZDogYnQuZ2V0KCdidElkJyksCiAgICAgICAgICBuYW1lOiBidC5nZXQoaTE4bi50KGNvbnN0YW50cy50cmFuc2xhdGlvbktleXMucGF0dGVybnMgKyAnLmNvbHVtbnMnKVswXS50b0xvd2VyQ2FzZSgpKQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgZGF0YSA9IHN0b3JlLmdldEl0ZW0oc3RvcmVLZXkpOwoKICAgICAgaWYgKGRhdGEgJiYgJ3NlbGVjdGVkQmFja3Rlc3QnIGluIGRhdGEgJiYgYmFja3Rlc3RzTmFtZXMubWFwKGZ1bmN0aW9uIChibikgewogICAgICAgIHJldHVybiBibi5uYW1lOwogICAgICB9KS5pbmNsdWRlcyhkYXRhLnNlbGVjdGVkQmFja3Rlc3QubmFtZSkpIHsKICAgICAgICBzZWxlY3RlZEJhY2t0ZXN0ID0gZGF0YS5zZWxlY3RlZEJhY2t0ZXN0OwogICAgICB9CgogICAgICBpZiAoIXNlbGVjdGVkQmFja3Rlc3QgJiYgYmFja3Rlc3RzTmFtZXMubGVuZ3RoKSB7CiAgICAgICAgc2VsZWN0ZWRCYWNrdGVzdCA9IGJhY2t0ZXN0c05hbWVzWzBdOwogICAgICB9CgogICAgICB1cGRhdGVLZXkrKzsKICAgIH0gZWxzZSB7CiAgICAgIGxvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBiYWNrdGVzdHNOYW1lczogYmFja3Rlc3RzTmFtZXMsCiAgICAgIGxvYWRpbmc6IGxvYWRpbmcsCiAgICAgIHNlbGVjdGVkQmFja3Rlc3Q6IHNlbGVjdGVkQmFja3Rlc3QsCiAgICAgIHVwZGF0ZUtleTogdXBkYXRlS2V5CiAgICB9OwogIH0sCiAgLy8gcGx1cmF6bGl6ZXIKICBwbHVyYWxpemU6IGZ1bmN0aW9uIHBsdXJhbGl6ZShuciwgdHJhbnNsYXRpb25LZXkpIHsKICAgIHZhciBucnNLZXkgPSB0cmFuc2xhdGlvbktleSArICdzJzsKCiAgICBpZiAobnIgPT09IDApIHsKICAgICAgcmV0dXJuIGkxOG4udChucnNLZXkpOwogICAgfQoKICAgIGlmIChuciA9PT0gMSkgewogICAgICByZXR1cm4gaTE4bi50KHRyYW5zbGF0aW9uS2V5KTsKICAgIH0KCiAgICBpZiAobnIgPCA1KSB7CiAgICAgIHJldHVybiBpMThuLnQobnJzS2V5ICsgJ1RvNCcpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGkxOG4udChucnNLZXkpOwogICAgfQogIH0sCiAgb2JqZWN0RW1wdHk6IGZ1bmN0aW9uIG9iamVjdEVtcHR5KG9iaikgewogICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID09PSAwICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0OwogIH0sCiAgZ2V0RGVmYXVsdFByTmFtZTogZnVuY3Rpb24gZ2V0RGVmYXVsdFByTmFtZShidElkKSB7CiAgICByZXR1cm4gJ3ByXycgKyBidElkOwogIH0sCiAgZ2V0QmFja3Rlc3RQYXR0ZXJuc1RhYmxlQmFzZTogZnVuY3Rpb24gZ2V0QmFja3Rlc3RQYXR0ZXJuc1RhYmxlQmFzZShkYXR1bSwgc3RvcmUsIGJ0c0NvbHVtbnMpIHsKICAgIHZhciBuYW1lID0gdGhpcy5nZXREZWZhdWx0UHJOYW1lKGRhdHVtLmlkKTsKICAgIHZhciBzeW1ib2wgPSBkYXR1bS50aWNrZXI7CiAgICB2YXIgcGF0dGVybiA9IGRhdHVtLnBhdHRlcm47CiAgICB2YXIgZGF0YSA9IHN0b3JlLmdldEl0ZW0oY29uc3RhbnRzLnN0b3JlS2V5cy5iYWNrdGVzdFBhdHRlcm5zKTsKCiAgICBpZiAoZGF0YSkgewogICAgICB2YXIgYmFja3Rlc3RzID0gdGhpcy5nZXRTdG9yZWRCYWNrdGVzdHMoZGF0YSk7CgogICAgICBpZiAoYmFja3Rlc3RzKSB7CiAgICAgICAgdmFyIG5hbWVzID0gYmFja3Rlc3RzLmZpbHRlcihmdW5jdGlvbiAoYnQpIHsKICAgICAgICAgIHJldHVybiBidC5nZXQoJ2J0SWQnKSA9PT0gZGF0dW0uaWQ7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChuYW1lcy5sZW5ndGgpIHsKICAgICAgICAgIG5hbWUgPSBuYW1lc1swXS5nZXQoYnRzQ29sdW1uc1swXS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9CgogICAgICAgIHZhciBzeW1ib2xzID0gYmFja3Rlc3RzLmZpbHRlcihmdW5jdGlvbiAoYnQpIHsKICAgICAgICAgIHJldHVybiBidC5nZXQoJ2Fzc2V0SWQnKSA9PT0gZGF0dW0udGlja2VyOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoc3ltYm9scy5sZW5ndGgpIHsKICAgICAgICAgIHN5bWJvbCA9IHN5bWJvbHNbMF0uZ2V0KGJ0c0NvbHVtbnNbNF0udG9Mb3dlckNhc2UoKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGF0dGVybnMgPSBiYWNrdGVzdHMuZmlsdGVyKGZ1bmN0aW9uIChidCkgewogICAgICAgICAgcmV0dXJuIGJ0LmdldCgncGF0dGVybklkJykgPT09IGRhdHVtLnBhdHRlcm47CiAgICAgICAgfSk7CgogICAgICAgIGlmIChwYXR0ZXJucy5sZW5ndGgpIHsKICAgICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuc1swXS5nZXQoYnRzQ29sdW1uc1s1XS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBuYW1lOiBuYW1lLAogICAgICBzeW1ib2w6IHN5bWJvbCwKICAgICAgcGF0dGVybjogcGF0dGVybgogICAgfTsKICB9LAogIC8vIGdsb2JhbCBmaWx0ZXJzCiAgcm91bmRUb0ZpeGVkOiBmdW5jdGlvbiByb3VuZFRvRml4ZWQodmFsdWUpIHsKICAgIGlmICghdmFsdWUgfHwgTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSAvLyByb3VuZHMgdG8gMiBtYW50aXNzYSBwbGFjZXMKCgogICAgcmV0dXJuIHZhbHVlID8gdmFsdWUgaW5zdGFuY2VvZiBOdW1iZXIgfHwgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyA/IHZhbHVlLnRvRml4ZWQoMikgOiBbaXNOYU4oTnVtYmVyKHZhbHVlLnNwbGl0KCcgJylbMF0pKSA/IHZhbHVlLnNwbGl0KCcgJylbMF0gOiBOdW1iZXIodmFsdWUuc3BsaXQoJyAnKVswXSkudG9GaXhlZCgyKSwgdmFsdWUuc3BsaXQoJyAnKVsxXS5yZXBsYWNlKG5ldyBSZWdFeHAoJyZuYnNwOycsICJnIiksICcgJyldLmNvbmNhdCh2YWx1ZS5zcGxpdCgnICcpLnNsaWNlKDIsIHZhbHVlLnNwbGl0KCcgJykubGVuZ2h0KSkuam9pbignICcpIDogdmFsdWU7CiAgfSwKICBjaGFydFVwZGF0ZVRzVGV4dDogZnVuY3Rpb24gY2hhcnRVcGRhdGVUc1RleHQodHMsIGxvYWRpbmcpIHsKICAgIC8vIHJldHVybnMgUlJSUi1NLUQgSDpNOlMgbGlrZSBmb3JtYXR0ZWQgdGV4dCBmb3IgY2hhcnQgKGlmIG5vdCBsb2FkaW5nKQogICAgaWYgKGxvYWRpbmcpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgaWYgKHRzKSB7CiAgICAgIHZhciBuZXdEdCA9IG5ldyBEYXRlKHRzKTsKICAgICAgcmV0dXJuIGkxOG4udCgnY2hhcnRVcGRhdGVkUHJlZml4JykgKyAnICcgKyBuZXdEdC5nZXRGdWxsWWVhcigpICsgIi0iICsgTnVtYmVyKG5ld0R0LmdldE1vbnRoKCkgKyAxKSArICItIiArIG5ld0R0LmdldERhdGUoKSArICIgIiArIG5ld0R0LmdldEhvdXJzKCkgKyAiOiIgKyBuZXdEdC5nZXRNaW51dGVzKCkgKyAiOiIgKyBuZXdEdC5nZXRTZWNvbmRzKCk7CiAgICB9CgogICAgcmV0dXJuIGkxOG4udCgnY2hhcnROZXZlclVwZGF0ZWQnKTsKICB9Cn07"},{"version":3,"sources":["/home/dufek/Documents/gitlab/frs-apps/src/custom/assets/js/helper.js"],"names":["i18n","constants","cagr","equity","nrOfQuarters","Math","pow","length","ytd","data","last_equity","last_quarters_equity","maxDD","min","map","val","ind","max","slice","nr","now","Date","monthBefore","getMonth","yearBefore","getFullYear","timeFiltered","time","filter","dt","getDate","sortAggregator","oldRows","newRows","sortCl","concat","sort","row1","row2","weightedAverageAggregator","weight","lastRowNoAverage","rows","firstTime","allRows","rowNr","forEach","oldRow","aggRow","Object","entries","key","oldVal","newVal","Number","sep","oldValSplitted","split","isNaN","noAverage","newWeight","join","push","createTradesRow","datum","base","keys","output","trades","pnl","_","symbol","pattern","direction","formatDateTime","start","finish","createPerfMetricsRow","initial_capital","defaultUnit","stats","profit_take_value","profit_take_unit","stop_loss_value","stop_loss_unit","pad","String","formatDate","delimiter","newDt","deformatDate","date","substring","getHours","getMinutes","getSeconds","formatDateOnly","formatDateTimes","datetimes","newDatetimes","isNumber","notifyAudio","self","element","type","msg","play","$notify","message","convertTimeframe","timeframe","index","t","indexOf","convertDirection","strings","bullish","bearish","mapStrategyFromRow","row","clNr","columns","translationKeys","patterns","get","toLowerCase","profit_take","stop_loss","directions","values","getPatternLabQueryData","assets","sa","sp","id","encodeQueryData","ret","d","undefined","encodeURIComponent","getPatternLabChartUrl","asset","range","urls","patternLab","chart","encodeRouteParams","getPatternLabHistoryUrl","patternsHistory","getAssetsPatternsPickerData","store","getItem","storeKeys","assetsPatternsPicker","from","to","selectedAssets","checkedAssets","checkedAsset","selectedPatterns","checkedPatterns","checkedAllPatterns","updateStore","value","storeKey","storeData","setItem","updateStoreBacktests","newRow","Map","timeframeKey","directionKey","set","Array","getStoredBacktests","bts","backtests","bt","cls","column","getBacktestsNames","updateKey","backtestPatterns","backtestsNames","selectedBacktest","loading","name","bn","includes","pluralize","translationKey","nrsKey","objectEmpty","obj","constructor","getDefaultPrName","btId","getBacktestPatternsTableBase","btsColumns","ticker","names","symbols","roundToFixed","isInteger","toFixed","replace","RegExp","lenght","chartUpdateTsText","ts"],"mappings":"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","sourcesContent":["import i18n from \"@/i18n\"\nimport constants from './constants';\n\nexport default { \n    // statistics\n    cagr(equity, nrOfQuarters) {\n        // cagr = (df['equity'].iloc[-1] / df['equity'].iloc[0]) ** (1 / (time_span.days/365)) - 1\n        return Math.pow(equity[equity.length - 1] / equity[0], 1 / (nrOfQuarters / 4)) - 1\n    },\n\n    ytd(data, nrOfQuarters) {\n        // ytd = (this_year['equity'].iloc[-1] / this_year['equity'].iloc[0]) * 100 - 100\n        let last_equity = this.last_quarters_equity(data, nrOfQuarters)\n        return last_equity.length ? (last_equity[last_equity.length - 1] / last_equity[0]) * 100 - 100 : 0\n    },\n\n    maxDD(data, nrOfQuarters) {\n        // maxdd = ((df['equity'] - df['equity'].cummax()) / df['equity']).min() * 100\n        let last_equity = this.last_quarters_equity(data, nrOfQuarters)\n        return last_equity.length ? Math.min(...last_equity.map((val,ind) => (val - Math.max(...last_equity.slice(0, ind + 1))) / val)) * 100 : 0\n    },\n\n    last_quarters_equity(data, nr) {\n        // this_year = df[df['time'] > dt.datetime(now.year, 1, 1)]\n        let now = new Date(Date.now())\n        let monthBefore = now.getMonth() - (nr * 3)\n        let yearBefore = now.getFullYear() - (monthBefore < 0 ? 1 : 0)        \n        let timeFiltered = data.time.filter(dt => new Date(dt) >= new Date(yearBefore, monthBefore < 0 ? 12 + monthBefore : monthBefore, now.getDate()))\n        return data.equity.slice(data.equity.length - timeFiltered.length, data.equity.length)\n    },\n\n    // agregators\n    sortAggregator(oldRows, newRows, sortCl) {\n        return oldRows.concat(newRows).sort((row1, row2) => {\n          // sort in descending order by dateTime\n          if (row1[sortCl] > row2[sortCl]) return -1;\n          if (row1[sortCl] < row2[sortCl]) return 1;\n          /* else */ return 0;\n        })\n    },\n\n    weightedAverageAggregator(oldRows, newRows, weight, lastRowNoAverage=true) {\n        // average values at same place\n        let rows = []\n        let firstTime = !oldRows.length || !newRows.length\n\n        let allRows = firstTime ? oldRows.concat(newRows) : oldRows\n        let rowNr = 0\n\n        allRows.forEach(oldRow => {\n            let aggRow = {}\n            \n            for (const [key, oldVal] of Object.entries(oldRow)) {\n                if (typeof oldVal === \"boolean\") {\n                    var newVal = oldVal\n                } else {\n                if (!oldVal) {\n                    continue\n                }\n\n                if (oldVal instanceof Number || typeof oldVal === 'number') {\n                        newVal = oldVal\n                } else {\n                    // split because in portfolio card it is in '<statisticName>: <number>' format\n                    var sep = ': '\n                    var oldValSplitted = oldVal.split(sep)\n\n                    newVal = oldValSplitted[oldValSplitted.length - 1]\n                }\n\n                if (!isNaN(Number(newVal))) {\n                    // final weighted average of old and new value\n                    let noAverage = !(lastRowNoAverage && rowNr === allRows.length - 1)\n                    let newWeight = noAverage ? weight : 1\n\n                    newVal = ((firstTime ? newWeight : 1) * Number(newVal))\n                                + (firstTime\n                                    ? 0\n                                    : (newWeight * ((oldValSplitted && oldValSplitted.length > 1) \n                                                    ? Number(newRows[rowNr][key].split(sep)[1]) \n                                                    : newRows[rowNr][key]))\n                                    )\n                    if (noAverage && !firstTime) {  \n                        // it's probably Equity outstanding statistic                          \n                        newVal /= 2\n                    }\n                }\n                \n                if (oldValSplitted && oldValSplitted.length > 1) {\n                    newVal = [ oldValSplitted[0], newVal ].join(sep)\n                } \n                }\n\n                aggRow[key] = newVal\n            }\n\n            rows.push(aggRow)\n            rowNr++\n        })\n\n        return rows\n    },\n    createTradesRow(rows, datum, base) {\n        let rowNr = 0\n\n        Object.keys(datum.output.trades.pnl).forEach(_ => \n            rows.push([\n                rowNr + 1,    // #                    \n                base.symbol,    // Asset                    \n                base.pattern,    // Pattern\n                datum.direction,   // Direction\n                'Entry price',   // Entry price\n                'Exit price',   // Exit price\n                this.formatDateTime(datum.output.trades.start[rowNr]),   // Entry time\n                this.formatDateTime(datum.output.trades.finish[rowNr]),   // Exit time\n                'Amount',   // Amount\n                datum.output.trades.pnl[rowNr++]   // PnL\n            ])\n        )\n    },\n    createPerfMetricsRow(rows, datum, base) {\n        rows.push([\n            base.symbol,    // Asset\n            base.pattern,    // Pattern\n            Object.keys(datum.output.trades.pnl).length,   // # of trades\n            `${datum.initial_capital} ${constants.defaultUnit}`,   // Initial capital\n            `${datum.initial_capital + datum.output.stats[\"Cummulative pnl final\"]} ${constants.defaultUnit}`,   // End capital\n            `${datum.output.stats[\"Cummulative pnl final\"]} ${constants.defaultUnit}`,    // Cummulative PnL final\n            'CAGR',    // CAGR\n            datum.output.stats[\"Sharpe ratio\"],  // Sharpe ratio\n            `${datum.profit_take_value} ${datum.profit_take_unit}`,   // PT\n            `${datum.stop_loss_value} ${datum.stop_loss_unit}`,   // SL\n            datum.output.stats[\"Avg. trade net profit per trade\"],  // Average trade\n            datum.output.stats[\"Max drawdown strategy\"]  // Max drawdown strategy\n        ])\n    },\n\n    // date-time types formatting    \n    pad(nr) {\n        return String(nr).length < 2 ? \"0\" + nr : nr\n    },\n\n    formatDate(dt, delimiter=\"-\") {\n        // returns RRRR<delimiter>MM<delimiter>DD format\n        if (dt) {\n            let newDt = new Date(dt)\n            return newDt.getFullYear() + delimiter + this.pad(Number(newDt.getMonth() + 1)) + delimiter + this.pad(newDt.getDate())\n        }\n    },\n\n    deformatDate(date) {\n        // for RRRRMMDD formatted inputs\n        // returns new Date() format\n        return date !== null ? new Date(date.substring(0,4), Number(date.substring(4,6)) - 1, date.substring(6,8)) : null\n    },\n\n    formatDateTime(dt) {\n        // returns RRRR-MM-DD HH:MM:SS formatted date from string of type YYYY-MM-DDTHH:MM:SS\n        let newDt = new Date(dt)\n        return this.formatDate(newDt) + \" \" + this.pad(newDt.getHours()) + \":\" + this.pad(newDt.getMinutes()) + \":\" + this.pad(newDt.getSeconds())\n    },\n\n    formatDateOnly(date) {\n        // for RRRRMMDD formatted inputs\n        // returns in RRRR-M-D format\n        return date.substring(0,4) + \"-\" + date.substring(4,6) + \"-\" + date.substring(6,8)\n    },\n\n    formatDateTimes(datetimes) {\n        // formatDatetime on array\n        let newDatetimes = []\n        datetimes.forEach(dt => {\n          newDatetimes.push(this.formatDateTime(dt))\n        })\n        return newDatetimes\n    },\n\n    isNumber(val) {\n        return val instanceof Number || typeof val === 'number'\n    },\n\n    notifyAudio(self, element, type, msg) {\n        element.play();\n\n        self.$notify({\n          type: type, \n          message: msg\n        })\n    },\n\n    // convertors\n    convertTimeframe(timeframe) {\n        let index = i18n.t('research.patternLab.timeframes').indexOf(timeframe)\n        return index > -1 ? index + 1 : -1\n    },\n\n    convertDirection(nr) {\n        return !nr ? nr : (nr > 0 ? constants.strings.bullish : constants.strings.bearish)\n    },\n\n    // query & urls methods\n    mapStrategyFromRow(row, map=true) {\n        // map Patterns table row to API structure\n        let data = {}\n        let clNr = 1    // 0th is Name - no need to map\n        let columns = i18n.t(constants.translationKeys.patterns + '.columns')\n\n        let val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            data['start_date'] = val // From\n        }\n        clNr++\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            data['finish_date'] = val    // To\n        }\n        clNr++\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            data['time_frame'] = i18n.t('research.patternLab.timeframes').indexOf(val) + 1    // Time frame    // it's a big mystery why BE indexes from 1\n        }\n\n        val = (map && row.get('assetId')) || (!map && row['assetId'])\n        data['asset'] = val   // Asset\n\n        val = (map && row.get('patternId')) || (!map && row['patternId'])\n        data['pattern'] = val  // Pattern\n        clNr += 3\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            data['initial_capital'] = val.split(' ')[0]\n        }\n        clNr += 2\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            let profit_take = val.split(' ')\n            data['profit_take_value'] = profit_take[0]\n            data['profit_take_unit'] = profit_take[1]\n        }\n        clNr++\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            let stop_loss = val.split(' ')\n            data['stop_loss_value'] =  stop_loss[0]\n            data['stop_loss_unit'] =  stop_loss[1]\n        }\n        clNr++\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        if (val) {\n            data['ma_filter_period'] = val.split(' ')[0]\n        }\n        clNr++\n\n        val = (map && row.get(columns[clNr].toLowerCase())) || (!map && row[columns[clNr].toLowerCase()])\n        let directions = i18n.t('research.patternLab.backtestPatterns.entryRules.directions')\n        data['direction'] = Object.keys(directions)[Object.values(directions).indexOf(val)]\n\n        val = (map && row.get('fixed_amount')) || (!map && row['fixed_amount'])\n        if (val) {\n            data['fixed_amount'] = val  // Risk\n        }\n\n        return data\n    },\n    getPatternLabQueryData(assets, patterns, timeframe) {\n        let data = {}\n\n        data['symbols'] = assets.map(sa => sa.symbol)\n        data['patterns'] = patterns.map(sp => sp.id)        \n        data['timeframe'] = this.convertTimeframe(timeframe)\n        \n        return data\n    },\n    encodeQueryData(data) {\n        const ret = [];\n        for (let d in data) {\n            if (data[d] !== null && data[d] !== undefined) {\n                ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));\n            }\n        }\n        return \"?\" + ret.join('&');\n    },\n    getPatternLabChartUrl(asset, timeframe, range=null) {\n        return constants.urls.patternLab.chart + this.encodeRouteParams([ asset.id, this.convertTimeframe(timeframe) ]) + this.encodeQueryData(range)\n    },\n    getPatternLabHistoryUrl(assets, patterns, timeframe) {\n        return assets.length && patterns.length\n                ? [ constants.urls.patternLab.patternsHistory + this.encodeQueryData(this.getPatternLabQueryData(assets, patterns, timeframe)) ]\n                : []\n    },\n    encodeRouteParams(data) {\n        return data.join('/');\n    },\n\n    // store methods\n    getAssetsPatternsPickerData(store) {\n        let data = store.getItem(constants.storeKeys.assetsPatternsPicker)\n        if (data) {\n            return {\n                timeframe: i18n.t('research.patternLab.timeframes')[data.timeframe ? data.timeframe : 0],\n                range: {\n                    from: data.range && data.range.from ? data.range.from : null,\n                    to: data.range && data.range.to ? data.range.to : null\n                },\n                \n                // assets\n                selectedAssets: data.selectedAssets ? data.selectedAssets : [],\n                checkedAssets: data.checkedAssets ? data.checkedAssets : (data.selectedAssets ? data.selectedAssets : []),\n                checkedAsset: data.checkedAsset ? data.checkedAsset : (data.checkedAssets && data.checkedAssets.length ? data.checkedAssets[0] : null),\n\n                // patterns\n                selectedPatterns: data.selectedPatterns ? data.selectedPatterns : [],\n                checkedPatterns: data.checkedPatterns ? data.checkedPatterns : [],\n                checkedAllPatterns: data.checkedAllPatterns\n            }\n        }\n    },\n    updateStore(store, key, value, storeKey=constants.storeKeys.assetsPatternsPicker) {\n        let storeData = store.getItem(storeKey)\n        if (!storeData) {\n            storeData = {}\n        }\n        storeData[key] = value\n        store.setItem(storeKey, storeData)\n    },\n    updateStoreBacktests(store, key, value, storeKey=constants.storeKeys.assetsPatternsPicker) {\n        this.updateStore(store, key, value.map(row => {\n            let newRow = new Map(row)\n\n            let timeframeKey = i18n.t(constants.translationKeys.patterns + '.columns')[3].toLowerCase()\n            let directionKey = i18n.t(constants.translationKeys.patterns + '.columns')[11].toLowerCase()\n            newRow.set(directionKey, Object.values(i18n.t('research.patternLab.backtestPatterns.entryRules.directions')).indexOf(row.get(directionKey)))\n            newRow.set(timeframeKey, i18n.t('research.patternLab.timeframes').indexOf(row.get(timeframeKey)))\n\n            return Array.from(newRow.values())\n        }), storeKey)    // cannot store language dependent keys\n    },\n    getStoredBacktests(data) {\n        let bts = []\n\n        if (data.backtests) {\n            data.backtests.forEach(bt => {\n                let row = new Map()\n                let clNr = 0                \n\n                row.set('btId', bt[clNr++])\n                row.set('assetId', bt[clNr++])\n                row.set('patternId', bt[clNr++])\n\n                // add columns values from translations\n                let cls = i18n.t(constants.translationKeys.patterns + '.columns')\n                cls.forEach(column => { \n                    if (column) { \n                        row.set(column.toLowerCase(), bt[clNr++]) \n                    } \n                })\n                \n                let timeframeKey = cls[3].toLowerCase()\n                let directionKey = cls[11].toLowerCase()\n                row.set(directionKey, Object.values(i18n.t('research.patternLab.backtestPatterns.entryRules.directions'))[row.get(directionKey)])\n                row.set(timeframeKey, i18n.t('research.patternLab.timeframes')[row.get(timeframeKey)])\n\n                row.set('fixed_amount', bt[15])     // Risk\n\n                bts.push(row)\n            })\n        }\n\n        return bts\n    },\n    getBacktestsNames(store, storeKey, updateKey) {             \n        let data = store.getItem(constants.storeKeys.backtestPatterns)\n        let backtestsNames = []\n        let selectedBacktest = null\n\n        if (data) {\n          var loading = data.loading\n          \n          this.getStoredBacktests(data).forEach(bt => backtestsNames.push({ id: bt.get('btId'), name: bt.get(i18n.t(constants.translationKeys.patterns + '.columns')[0].toLowerCase()) }))\n\n          data = store.getItem(storeKey)\n          if (data && 'selectedBacktest' in data && backtestsNames.map(bn => bn.name).includes(data.selectedBacktest.name)) {\n            selectedBacktest = data.selectedBacktest \n          }\n          if (!selectedBacktest && backtestsNames.length) {\n            selectedBacktest = backtestsNames[0]\n          }\n\n          updateKey++\n        } else {\n          loading = false\n        }\n\n        return { backtestsNames, loading, selectedBacktest, updateKey }\n    },\n\n    // plurazlizer\n    pluralize(nr, translationKey) {\n        let nrsKey = translationKey + 's'\n\n        if (nr === 0) {\n            return i18n.t(nrsKey)\n        }\n        if (nr === 1) {\n            return i18n.t(translationKey)\n        }\n        if (nr < 5) {\n            return i18n.t(nrsKey + 'To4')\n        } else {\n            return i18n.t(nrsKey)\n        }\n    },\n    objectEmpty(obj) {\n        return Object.keys(obj).length === 0 && obj.constructor === Object\n    },\n\n    getDefaultPrName(btId) {\n        return 'pr_' + btId\n    },\n\n    getBacktestPatternsTableBase(datum, store, btsColumns) {\n        let name = this.getDefaultPrName(datum.id)\n        let symbol = datum.ticker\n        let pattern = datum.pattern\n\n        let data = store.getItem(constants.storeKeys.backtestPatterns)\n        if (data) {\n            let backtests = this.getStoredBacktests(data)\n            if (backtests) {\n                let names = backtests.filter(bt => bt.get('btId') === datum.id)\n                if (names.length) {\n                    name = names[0].get(btsColumns[0].toLowerCase())\n                }\n                let symbols = backtests.filter(bt => bt.get('assetId') === datum.ticker)\n                if (symbols.length) {\n                    symbol = symbols[0].get(btsColumns[4].toLowerCase())\n                }                \n                let patterns = backtests.filter(bt => bt.get('patternId') === datum.pattern)\n                if (patterns.length) {\n                    pattern = patterns[0].get(btsColumns[5].toLowerCase())\n                }                    \n            }\n        }\n\n        return { name:name, symbol:symbol, pattern:pattern }\n    },\n\n    // global filters\n    roundToFixed(value) {\n        if (!value || Number.isInteger(value)) {\n            return value\n        }\n\n        // rounds to 2 mantissa places\n        return value ? ((value instanceof Number || typeof value === 'number')\n                        ? value.toFixed(2)\n                        : [\n                            isNaN(Number(value.split(' ')[0])) ? value.split(' ')[0] : Number(value.split(' ')[0]).toFixed(2),\n                            value.split(' ')[1].replace(new RegExp('&nbsp;', \"g\"), ' ')\n                          ].concat(value.split(' ').slice(2, value.split(' ').lenght)).join(' '))\n                    : value\n    },\n    \n    chartUpdateTsText(ts, loading) {\n        // returns RRRR-M-D H:M:S like formatted text for chart (if not loading)\n        if (loading) {\n            return null\n        }\n\n        if (ts) {            \n            let newDt = new Date(ts)\n            return i18n.t('chartUpdatedPrefix') + ' ' + newDt.getFullYear() + \"-\" + Number(newDt.getMonth() + 1) + \"-\" + newDt.getDate() + \" \" + newDt.getHours() + \":\" + newDt.getMinutes() + \":\" + newDt.getSeconds()\n        }\n\n        return i18n.t('chartNeverUpdated')\n    }\n}"]}]}